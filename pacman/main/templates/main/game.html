{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
    <style>
        table, tr, td {
            border: none;
            border-width:0px;
            border-collapse: collapse;
            border-spacing: 0;
            margin: 0;
            padding: 0;
        }
        img {margin:0;padding:0; display:block;}
</style>
</head>
<body>
    {% if message == "This username already exists." %}
        {{ message }}
    {% else %}
        <script>
            var mapp;
            var score;
           /* function httpGetAsync(theUrl)
            {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                        mapp=xmlHttp.responseText['map'];
                        console.log(mapp);
                        score=xmlHttp.responseText['scoreboard'];
                }
                xmlHttp.open("GET", theUrl, true); // true for asynchronous
                xmlHttp.send(null);
            }
            document.onkeydown = checkKey;
            function checkKey(e) {

                e = e || window.event;

                if (e.keyCode == '38') {
                    // up arrow
                alert("up");
               //     httpGetAsync('/?dir=u',{{map|safe}});

                }
                else if (e.keyCode == '40') {
                    // down arrow
                }
                else if (e.keyCode == '37') {
                   // left arrow
                    alert("left");
                    httpGetAsync('/?dir=l');
                }
                else if (e.keyCode == '39') {
                   // right arrow
                }

            }
*/
            var mapp = {{ map|safe }};
            console.log(typeof mapp);
            document.write("<table style='width=10%' align='center' cellspacing='0' cellpadding='0'>");
            for (var i = 0; i < 11; i++){
                document.write("<tr>");
                for (var j = 0; j < 11; j++){
                    document.write("<td>");
                    if (mapp[i][j] == 'r'){
                        document.write("<img src='{% static '../../static/road.png' %}' alt='R'>");
                        //mapp[i][j] = 'R';
                    }
                    else if(mapp[i][j]=='P'){
                        document.write("<img src='{% static '../../static/pacman.png' %}' alt='P'>");
                    }
                    else if(mapp[i][j]=='G'){
                        document.write("<img src='{% static '../../static/ghost.png' %}' alt='G'>");
                    }
                    else if(mapp[i][j]=='X'){
                        document.write("<img src='{% static '../../static/wall.png' %}' alt='W'>");
                    }
                    else if(mapp[i][j]=='A'){
                        document.write("<img src='{% static '../../static/apple.png' %}' alt='A'>");
                    }
                    else if(mapp[i][j]=='T'){
                        document.write("<img src='{% static '../../static/potato.png' %}' alt='T'>");
                    }
                    else if(mapp[i][j]=='B'){
                        document.write("<img src='{% static '../../static/banana.png' %}' alt='B'>");
                    }

                }
                //document.write("<br>");
                document.write("</td>");
                document.write("</tr>");
            }
            document.write("</table>");
            document.write("<br>");
            score={{scoreboard|safe }};
            document.write("#############SCOREBOARD#############");
            document.write("<table style='width=10%'>");
            document.write("<br>");
            document.write("<tr>");
            for(var i = 0; i<score[0].length;i++ ){
                //document.write("<td>");
                document.write(score[0][i]+"   " + score[1][i] );
                document.write("<br/>");

            }
            //document.write("</td>");
            document.write("</tr>");
            document.write("</table>");
        </script>
        <form action="/game/" method="GET">
            <input type="hidden" name="dir" value="l" />
            <input type="submit" value="Left">
        </form>
        <form action="/game/" method="GET">
            <input type="hidden" name="dir" value="r" />
            <input type="submit" value="Right">
        </form>
        <form action="/game/" method="GET">
            <input type="hidden" name="dir" value="u" />
            <input type="submit" value="Up">
        </form>
        <form action="/game/" method="GET">
            <input type="hidden" name="dir" value="d" />
            <input type="submit" value="Down">
        </form>
        <form action="/quit/" method="GET">

            <input type="submit" value="Quit">
        </form>
    {% endif %}
</body>
</html>